# iOS 2021 é¢è¯•å‰çš„å‡†å¤‡ï¼ˆä»ç½‘ç»œæœé›†å„ç§é¢è¯•é¢˜å¹¶è§£ç­”ï¼‰

> &emsp;å‰æœŸåŸºæœ¬é€šè¯»äº† Apple çš„äº”ä»½æºç  [objc4-781](https://opensource.apple.com/tarballs/objc4/)ã€[libdispatch-1173.40.5](https://opensource.apple.com/tarballs/libdispatch/)ã€[CF-1151.16](https://opensource.apple.com/tarballs/CF/)ã€[libmalloc-283.100.6](https://opensource.apple.com/tarballs/libmalloc/)ã€[libclosure-74](https://opensource.apple.com/source/libclosure/) åŸºæœ¬å¯¹ iOS çš„å¤§éƒ¨åˆ†åº•å±‚åŸç†éƒ½æœ‰äº†ä¸€ä¸ªåŸºç¡€çš„è®¤çŸ¥ï¼Œç„¶åç®—æ³•éƒ¨åˆ†çš„è¯æ˜¯ä¸“æ³¨åˆ·äº†ä¸¤é ã€Šå‰‘æŒ‡ Offerã€‹ï¼ˆåœ¨ IDE é‡Œå¯ä»¥å®Œæˆé»˜å†™ï¼Œå®Œå…¨æ‰‹å†™çš„è¯å¯èƒ½è¿˜éœ€è¦ä¸€äº›ç»ƒä¹ ï¼‰ã€‚é‚£ä¹ˆæ—¢ç„¶æ˜¯é¢è¯•è‚¯å®šå…ä¸äº†è¦åˆ·é¢˜ï¼Œé¢˜ç›®çš„è¯å°±ä»ç½‘ç»œæœé›†å„ä½å¤§ä½¬é¢è¯•æ—¶çš„é¢˜ç›®ï¼Œç„¶åè¯•ç€ä»è‡ªå·±çš„ç†è§£ä¸Šç»™é¢˜ç›®ä½œå‡ºè§£ç­”ï¼Œå¦‚æœ‰é”™è¯¯çš„åœ°æ–¹è¿˜æœ›å¤§å®¶è¿›è¡ŒæŒ‡æ­£ã€‚   

1. iOS å±å¹•æˆåƒåŸç†ï¼ˆç¦»å±æ¸²æŸ“ Off-screen Renderedï¼‰ã€‚
2. atomicã€nonatomicã€strongï¼ˆretainï¼‰ã€weakï¼ˆunsafe_unretainedï¼‰ã€assign å±æ€§ä¿®é¥°ç¬¦çš„å·¥ä½œåŸç†ã€‚ï¼ˆ\_\_strongã€\_\_weakã€\_\_unsafe_unretainedï¼‰
3. weak åº•å±‚å®ç°åŸç†ã€‚
  + DisguisedPtr<objc_object> DisguisedPtr<objc_object *> ä¼ªè£…æŒ‡é’ˆï¼ŒæŠŠåœ°å€å˜ä¸ºæ•´æ•°ä¿å­˜ã€‚
  + typedef DisguisedPtr<objc_object *> weak_referrer_t; weak å˜é‡çš„åœ°å€ï¼Œå³ä¸€ä¸ªæŒ‡é’ˆçš„æŒ‡é’ˆã€‚
  + struct weak_entry_t ä¿å­˜æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰ weak å˜é‡åœ°å€çš„å“ˆå¸Œè¡¨ã€‚
  + struct weak_table_t ä¿å­˜å¯¹è±¡å’Œå…¶ weak_entry_t çš„å“ˆå¸Œè¡¨ã€‚
  + struct SideTable æŸä¸ªå¯¹è±¡æ‰€å¤„çš„ SideTable è¡¨ï¼Œæœ‰ä¸‰ä¸ªæˆå‘˜å˜é‡ï¼šspinlock_t slockã€RefcountMap refcntsã€weak_table_t weak_tableã€‚
  + static StripedMap<SideTable>& SideTables ä¿å­˜ 8/64 å¼  SideTableï¼Œè·å–æŸä¸ªå¯¹è±¡æ‰€å¤„çš„ SideTableï¼šSideTable *table = &SideTables()[obj]ã€‚
  
  + å¯¹ weak_entry_t å’Œ weak_table_t çš„å“ˆå¸Œæ•°ç»„è¿›è¡Œæ“ä½œã€‚å­˜æ”¾ weak å˜é‡å’Œç§»é™¤ weak å˜é‡ã€weak å˜é‡ç½®ä¸º nil ç­‰æ“ä½œã€‚
  
  + objc_loadWeakRetainedã€objc_loadWeak weak å˜é‡è¯»å–ã€‚ï¼ˆobjc_copyWeakã€objc_moveWeakï¼‰
  
4. AssociatedObject åº•å±‚å®ç°åŸç†ã€‚class ObjcAssociation ç”¨äºä¿å­˜å…³è”ç­–ç•¥å’Œå…³è”å€¼ã€‚ObjectAssociationMap æ˜¯ key æ˜¯ const void *ï¼ˆç”¨äºæ ‡è¯†æŸä¸ªå…³è”å€¼çš„ keyï¼‰ï¼Œvalue æ˜¯ ObjcAssociation çš„å“ˆå¸Œè¡¨ã€‚AssociationsHashMap æ˜¯ key æ˜¯ DisguisedPtr<objc_object>ï¼Œvalue æ˜¯ ObjectAssociationMap çš„å“ˆå¸Œè¡¨ã€‚AssociationsManager æ˜¯ key æ˜¯ DisguisedPtr<objc_object>ï¼Œvalue æ˜¯ ObjectAssociationMap çš„å“ˆå¸Œè¡¨ã€‚
5. Category åº•å±‚å®ç°åŸç†ã€‚æ¦‚å¿µä¸æ•°æ®ç»“æ„ï¼šcategory_t






## å‚è€ƒé“¾æ¥
**å‚è€ƒé“¾æ¥:ğŸ”—**
+ [NSCoding](https://developer.apple.com/library/archive/documentation/LegacyTechnologies/WebObjects/WebObjects_3.5/Reference/Frameworks/ObjC/Foundation/Protocols/NSCoding/Description.html#//apple_ref/occ/intf/NSCoding)
